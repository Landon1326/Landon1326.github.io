<!DOCTYPE html>
<html>
  
  <head>
    <meta charset="utf-8" />
    <meta name="viewport"
    content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    
    <title>Lab 7 - Assignment 6</title>
    <link rel="stylesheet"href="https://js.arcgis.com/4.18/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.18/"></script>
    
    <style>
      html, 
      body, 
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;  
    }
    
    #timeSlider {
    position: absolute;
    left: 5%;
    right: 5%;
    bottom: 20px;
  }
</style>

<script>
  require([
    "esri/Map",
    "esri/views/MapView",
    "esri/layers/FeatureLayer",
    "esri/widgets/TimeSlider",
    "esri/widgets/Legend"
  ], function (Map, MapView, FeatureLayer, TimeSlider, Legend) {
//POPUP TEMPLATE
    const popupTemplate = {
      title: "Magnitude {mag} Earthquake near {place}",
      content: [{
        type: "fields",
        fieldInfos: [
          {
            fieldName: "mag",
            label: "Magnitude",
            format: {
              places: 1,
              digitSeparator: true
            }
          },
          {
            fieldName: "depth",
            label: "Depth (feet)"
          },
          {
            fieldName: "place",
            label: "Location"
          },
          {
          fieldName: "time",
          label: "Date/Time"
        }
        ]
      }]
    };

//FEATURE LAYER
const layer = new FeatureLayer({
  url:
"https://services9.arcgis.com/RHVPKKiFTONKtxq3/ArcGIS/rest/services/USGS_Seismic_Data_v1/FeatureServer/0",
      outFields: ["depth", "mag", "place", "time"],
      popupTemplate: popupTemplate,
      timeInfo: {
        startField: "time"
      }
});

//MAP
const map = new Map({
basemap: "topo-vector",
layers: [layer]
});

//MAP VIEW
const view = new MapView({
  map: map, 
  container: "viewDiv",
  zoom: 2, 
  center: [-150, 0]
});
      
//TIME SLIDER
const timeSlider = new TimeSlider({
  container: "timeSlider",
  view: view,
  timeVisible: true,
  loop: true
});

view.whenLayerView(layer).then(function (lv) {
timeSlider.fullTimeExtent = layer.timeInfo.fullTimeExtent.expandTo("hours");
});

timeSlider.stops = {
  interval: {
    value: 1,
    unit: "days"
  }
};

//LEGEND
const legend = new Legend({
  view: view
});

view.ui.add(legend, "top-left");
  
});
</script>
</head>

<body>
  <div id="viewDiv"></div>
  <div id="timeSlider"></div>
</body>
</html>